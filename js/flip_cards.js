// T√ºm JavaScript dosyalarƒ±nƒ±n EN √úST√úNE ekleyin:

// UserProfile kontrol√º - eƒüer y√ºklenmemi≈üse
if (typeof userProfile === 'undefined') {
    // Basit fallback fonksiyon
    window.updateUserProgress = function(points = 1) {
        console.log(`ƒ∞lerleme puanƒ±: ${points}`);
        // LocalStorage'a kaydet
        const progress = JSON.parse(localStorage.getItem('userProgress') || '{"totalPoints": 0}');
        progress.totalPoints = (progress.totalPoints || 0) + points;
        progress.lastUpdated = new Date().toISOString();
        localStorage.setItem('userProgress', JSON.stringify(progress));
    };
} else {
    // UserProfile varsa onu kullan
    window.updateUserProgress = function(points = 1) {
        userProfile.addLearnedWords(points);
    };
}

// Sayfa y√ºklendiƒüinde progress kontrol√º
document.addEventListener('DOMContentLoaded', function() {
    const progress = JSON.parse(localStorage.getItem('userProgress') || '{"totalPoints": 0}');
    console.log(`Toplam puan: ${progress.totalPoints}`);
});
// √áevir Kartlarƒ± JavaScript - RESPONSIVE DESTEKLƒ∞ G√úNCELLENDƒ∞
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ √áevir kartlarƒ± mod√ºl√º y√ºklendi - Responsive destekli');
    
    // Responsive √∂zellikleri ba≈ülat
    initResponsiveFeatures();
    
    const flashcardsContainer = document.getElementById('flashcardsContainer');
    const categorySelect = document.getElementById('categorySelect');
    const totalCardsSpan = document.getElementById('totalCards');
    const prevPageBtn = document.getElementById('prevPage');
    const nextPageBtn = document.getElementById('nextPage');
    const pageInfo = document.getElementById('pageInfo');
    
    // Modal elementleri
    const imageModal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    
    let wordsData = [];
    let filteredWords = [];
    let currentPage = 1;
    let cardsPerPage = getCardsPerPage(); // Responsive kart sayƒ±sƒ±
    let hoverTimer = null;
    let currentModalWord = null;
    let isModalFlipped = false;
    let isFlipping = false;
    
    // √ñƒürenim sƒ±rasƒ±na g√∂re kategori sƒ±ralamasƒ±
    const learningOrder = [
        'Greetings', 'Introduction', 'Emergency', 'Numbers',
        'Food', 'Foods', 'Drinks', 'Shopping', 'Colors', 'Family',
        'Time', 'Weather', 'Home', 'Body', 'Emotions',
        'Transportation', 'Vehicles', 'Travel', 'Hobbies', 'Animals', 'Fruits', 'Health',
        'Work', 'Education', 'Technology', 'Sports', 'TurkishCulture'
    ];

    // Responsive √∂zellikleri ba≈ülat
    function initResponsiveFeatures() {
        const isMobile = document.documentElement.classList.contains('mobile-device');
        const isTablet = document.documentElement.classList.contains('tablet');
        
        console.log(`üì± Responsive mod: ${isMobile ? 'Mobil' : isTablet ? 'Tablet' : 'Masa√ºst√º'}`);
        
        // Ekran boyutu deƒüi≈ütiƒüinde kart sayƒ±sƒ±nƒ± g√ºncelle
        window.addEventListener('resize', function() {
            cardsPerPage = getCardsPerPage();
            if (filteredWords.length > 0) {
                currentPage = 1;
                updatePagination();
                displayFlashcards();
            }
        });
    }
    
    // Cihaza g√∂re sayfa ba≈üƒ±na kart sayƒ±sƒ± belirle
    function getCardsPerPage() {
        const isMobile = document.documentElement.classList.contains('mobile-device');
        const isTablet = document.documentElement.classList.contains('tablet');
        
        if (isMobile) {
            return 8; // Mobilde daha az kart
        } else if (isTablet) {
            return 12; // Tablet'te orta seviye
        } else {
            return 16; // Masa√ºst√ºnde daha fazla
        }
    }
    
    // Modal i≈ülevselliƒüi - G√úNCELLENDƒ∞
    function openModal(word) {
        currentModalWord = word;
        isModalFlipped = false;
        isFlipping = false;
        modalImage.src = word.image;
        
        // Modal i√ßeriƒüini g√ºncelle - ƒ∞ngilizce y√ºz
        updateModalContent();
        
        imageModal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Modal event'lerini ba≈ülat
        initializeModalEvents();
    }
    
    function updateModalContent() {
        const modalWordElement = document.querySelector('.modal-word');
        const modalCategoryElement = document.querySelector('.modal-category');
        const modalLevelElement = document.querySelector('.modal-level');
        
        if (isModalFlipped) {
            // T√ºrk√ße y√ºz
            if (modalWordElement) {
                modalWordElement.textContent = currentModalWord.turkish;
                modalWordElement.className = 'modal-word turkish';
            }
            if (modalCategoryElement) {
                modalCategoryElement.textContent = 'T√ºrk√ße';
            }
        } else {
            // ƒ∞ngilizce y√ºz
            if (modalWordElement) {
                modalWordElement.textContent = currentModalWord.displayWord || currentModalWord.word;
                modalWordElement.className = 'modal-word english';
            }
            if (modalCategoryElement) {
                modalCategoryElement.textContent = currentModalWord.category;
            }
        }
        
        if (modalLevelElement) {
            modalLevelElement.textContent = currentModalWord.difficulty || 'easy';
            modalLevelElement.className = `modal-level ${currentModalWord.difficulty || 'easy'}`;
        }
        
        // D√∂nd√ºrme ikonunu g√ºncelle
        const flipIcon = document.querySelector('.modal-flip-icon i');
        if (flipIcon) {
            flipIcon.className = isModalFlipped ? 'fas fa-undo' : 'fas fa-sync-alt';
        }
    }
    
    function closeImageModal() {
        imageModal.classList.remove('active');
        document.body.style.overflow = '';
        isModalFlipped = false;
        isFlipping = false;
        currentModalWord = null;
    }
    
    // Modal kart d√∂nd√ºrme fonksiyonu - G√úNCELLENDƒ∞ (D√ñNME EFEKTƒ∞)
    function flipModalCard() {
        if (isFlipping || !currentModalWord) return;
        
        isFlipping = true;
        
        // G√∂rsele d√∂nme efekti uygula
        modalImage.classList.add('flipping');
        
        setTimeout(() => {
            // Kartƒ± √ßevir
            isModalFlipped = !isModalFlipped;
            
            // ƒ∞√ßeriƒüi g√ºncelle
            updateModalContent();
            
            // D√∂nme efekti kaldƒ±r
            setTimeout(() => {
                modalImage.classList.remove('flipping');
                isFlipping = false;
            }, 200);
        }, 200);
    }
    
    // Modal seslendirme fonksiyonu - G√úNCELLENDƒ∞ (T√úRK√áE SES AYARI)
    function speakModalWord() {
        if (currentModalWord) {
            if (isModalFlipped) {
                // T√ºrk√ße seslendirme - Geli≈ütirilmi≈ü ayarlar
                speakText(currentModalWord.turkish, 'tr-TR');
            } else {
                // ƒ∞ngilizce seslendirme
                speakText(currentModalWord.displayWord || currentModalWord.word, 'en-US');
            }
        }
    }
    
    // Modal event listener'larƒ±
    function initializeModalEvents() {
        const modalSpeakerIcon = document.querySelector('.modal-speaker-icon');
        const modalFlipIcon = document.querySelector('.modal-flip-icon');
        const modalCloseIcon = document.querySelector('.modal-close-icon');
        
        if (modalSpeakerIcon) {
            modalSpeakerIcon.onclick = function(e) {
                e.stopPropagation();
                speakModalWord();
            };
        }
        
        if (modalFlipIcon) {
            modalFlipIcon.onclick = function(e) {
                e.stopPropagation();
                flipModalCard();
            };
        }
        
        if (modalCloseIcon) {
            modalCloseIcon.onclick = function(e) {
                e.stopPropagation();
                closeImageModal();
            };
        }
    }
    
    // Modal kapatma event'leri
    imageModal.addEventListener('click', function(e) {
        if (e.target === imageModal) {
            closeImageModal();
        }
    });
    
    // ESC tu≈üu ile kapatma
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && imageModal.classList.contains('active')) {
            closeImageModal();
        }
    });
    
    // Kelimeleri y√ºkle
    loadData('../data/words.json')
        .then(data => {
            if (data && Array.isArray(data) && data.length > 0) {
                // Kelimeleri formatla ve zorluk seviyesine g√∂re sƒ±rala
                wordsData = data.map(word => ({
                    ...word,
                    displayWord: word.word.replace(/_/g, ' ')
                }));
                
                // Zorluk seviyesine g√∂re sƒ±rala: easy -> medium -> hard
                wordsData.sort((a, b) => {
                    const difficultyOrder = { 'easy': 1, 'medium': 2, 'hard': 3 };
                    const aOrder = difficultyOrder[a.difficulty] || 4;
                    const bOrder = difficultyOrder[b.difficulty] || 4;
                    return aOrder - bOrder;
                });
                
                filteredWords = [...wordsData];
                console.log(`‚úÖ ${wordsData.length} kelime y√ºklendi - ${cardsPerPage} kart/sayfa`);
                
                // Kategori se√ßeneklerini doldur
                updateCategoryOptions(wordsData);
                // Sayfalama ve kartlarƒ± g√∂ster
                updatePagination();
                displayFlashcards();
            } else {
                showError('Kartlar y√ºklenirken bir hata olu≈ütu.');
            }
        })
        .catch(error => {
            console.error('Hata:', error);
            showError('Veriler y√ºklenirken bir hata olu≈ütu.');
        });
    
    // Kategori se√ßeneklerini g√ºncelle - √ñƒûRENƒ∞M SIRASINA G√ñRE
    function updateCategoryOptions(words) {
        const categories = [...new Set(words.map(word => word.category))];
        
        // √ñƒürenim sƒ±rasƒ±na g√∂re sƒ±rala
        const orderedCategories = learningOrder.filter(cat => 
            categories.includes(cat)
        );
        
        const remainingCategories = categories.filter(cat => 
            !learningOrder.includes(cat)
        ).sort();
        
        const allCategories = [...orderedCategories, ...remainingCategories];
        
        allCategories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = getCategoryTurkishName(category);
            
            // Seviye bilgisi ekle
            const level = getCategoryLevel(category);
            if (level) {
                option.textContent += ` (${level})`;
            }
            
            categorySelect.appendChild(option);
        });
    }
    
    // Kategori seviyesini belirle
    function getCategoryLevel(category) {
        const index = learningOrder.indexOf(category);
        
        if (index === -1) return 'ƒ∞leri';
        
        if (index <= 3) return 'Ba≈ülangƒ±√ß';
        if (index <= 10) return 'Ba≈ülangƒ±√ß+';
        if (index <= 15) return 'Temel';
        if (index <= 22) return 'Orta';
        return 'ƒ∞leri';
    }
    
    // Kategori deƒüi≈ütiƒüinde filtrele
    categorySelect.addEventListener('change', function() {
        const selectedCategory = this.value;
        
        if (selectedCategory === 'all') {
            filteredWords = [...wordsData];
        } else {
            filteredWords = wordsData.filter(word => word.category === selectedCategory);
        }
        
        currentPage = 1;
        updatePagination();
        displayFlashcards();
    });
    
    // Sayfalama kontrollerini g√ºncelle
    function updatePagination() {
        const totalPages = Math.ceil(filteredWords.length / cardsPerPage);
        
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
        
        pageInfo.textContent = totalPages > 0 
            ? `Sayfa ${currentPage} / ${totalPages}` 
            : 'Kart bulunamadƒ±';
            
        totalCardsSpan.textContent = filteredWords.length;
    }
    
    // √ñnceki sayfa
    prevPageBtn.addEventListener('click', function() {
        if (currentPage > 1) {
            currentPage--;
            updatePagination();
            displayFlashcards();
        }
    });
    
    // Sonraki sayfa
    nextPageBtn.addEventListener('click', function() {
        const totalPages = Math.ceil(filteredWords.length / cardsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            updatePagination();
            displayFlashcards();
        }
    });
    
    // Kartlarƒ± g√∂r√ºnt√ºleme fonksiyonu - Responsive
    function displayFlashcards() {
        if (!filteredWords || filteredWords.length === 0) {
            flashcardsContainer.innerHTML = '<div class="no-cards"><p>Bu kategoride kart bulunamadƒ±.</p></div>';
            return;
        }
        
        const startIndex = (currentPage - 1) * cardsPerPage;
        const endIndex = Math.min(startIndex + cardsPerPage, filteredWords.length);
        const currentPageWords = filteredWords.slice(startIndex, endIndex);
        
        flashcardsContainer.innerHTML = '';
        
        currentPageWords.forEach((word, index) => {
            const flashcard = createFlashcard(word, index);
            flashcardsContainer.appendChild(flashcard);
        });
    }
    
    // Kart olu≈üturma fonksiyonu - Responsive
    function createFlashcard(word, index) {
        const flashcard = document.createElement('div');
        flashcard.className = 'flashcard';
        
        const displayWord = word.displayWord || word.word.replace(/_/g, ' ');
        
        // Zorluk seviyesi badge'i
        const difficultyBadge = word.difficulty ? `<span class="level-badge level-${word.difficulty}">${word.difficulty.toUpperCase()}</span>` : '';
        
        flashcard.innerHTML = `
            <div class="flashcard-inner">
                <div class="flashcard-front">
                    <div class="flashcard-image-container">
                        ${difficultyBadge}
                        <img src="${word.image}" alt="${displayWord}" class="flashcard-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjNmMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkeT0iLjM1ZW0iIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM5OTk5OTkiPlJlc2ltIFlvazwvdGV4dD48L3N2Zz4='">
                    </div>
                    <div class="flashcard-text">${displayWord}</div>
                    <div class="flashcard-hover-text">üîä Telaffuz i√ßin √ºzerinde bekleyin</div>
                </div>
                <div class="flashcard-back">
                    <div class="flashcard-text">${word.turkish}</div>
                    <div class="flashcard-category">${getCategoryTurkishName(word.category)}</div>
                </div>
            </div>
        `;
        
        // Resim tƒ±klama event'i - MODAL A√áMA
        const imageElement = flashcard.querySelector('.flashcard-image');
        imageElement.addEventListener('click', function(e) {
            e.stopPropagation();
            openModal(word);
        });
        
        // Tƒ±klama ile √ßevirme (k√º√ß√ºk kart)
        flashcard.addEventListener('click', function() {
            this.classList.toggle('flipped');
        });
        
        // Hover ile telaffuz
        flashcard.addEventListener('mouseenter', function() {
            const self = this;
            hoverTimer = setTimeout(() => {
                if (!self.classList.contains('flipped')) {
                    speakText(displayWord, 'en-US');
                }
            }, 800);
        });
        
        flashcard.addEventListener('mouseleave', function() {
            if (hoverTimer) {
                clearTimeout(hoverTimer);
            }
        });
        
        // Mobil i√ßin touch events
        let touchStartTime = 0;
        flashcard.addEventListener('touchstart', function() {
            touchStartTime = Date.now();
        });
        
        flashcard.addEventListener('touchend', function() {
            const touchDuration = Date.now() - touchStartTime;
            if (touchDuration > 500) {
                speakText(displayWord, 'en-US');
            }
        });
        
        // Animasyon i√ßin
        setTimeout(() => {
            flashcard.style.opacity = '1';
            flashcard.style.transform = 'scale(1)';
        }, index * 100);
        
        return flashcard;
    }
    
    // Hata g√∂sterimi
    function showError(message) {
        flashcardsContainer.innerHTML = `
            <div class="error-message">
                <p>${message}</p>
                <button onclick="location.reload()">Tekrar Dene</button>
            </div>
        `;
    }
});

// Kategori ƒ∞ngilizce ismini T√ºrk√ße'ye √ßevir
function getCategoryTurkishName(category) {
    const categoryMap = {
        'Animals': 'Hayvanlar',
        'Foods': 'Yiyecekler',
        'Colors': 'Renkler',
        'Vehicles': 'Ara√ßlar',
        'Numbers': 'Sayƒ±lar',
        'Greetings': 'Selamla≈üma',
        'Introduction': 'Tanƒ±≈üma',
        'Food': 'Yemek',
        'Shopping': 'Alƒ±≈üveri≈ü',
        'Travel': 'Seyahat',
        'Health': 'Saƒülƒ±k',
        'Emergency': 'Acil Durumlar',
        'Time': 'Zaman ve Tarih',
        'Weather': 'Hava Durumu',
        'Family': 'Aile ve ƒ∞li≈ükiler',
        'Work': 'ƒ∞≈ü ve Ofis',
        'Technology': 'Teknoloji ve ƒ∞nternet',
        'Home': 'Ev ve Ya≈üam',
        'Transportation': 'Ula≈üƒ±m ve Trafik',
        'Hobbies': 'Hobiler ve Bo≈ü Zaman',
        'Emotions': 'Duygular ve Hisler',
        'Education': 'Eƒüitim ve Okul',
        'TurkishCulture': 'T√ºrk K√ºlt√ºr√º',
        'Fruits': 'Meyveler',
        'Tools': 'Ara√ßlar',
        'Sports': 'Spor',
        'Furniture': 'Mobilya',
        'Drinks': 'ƒ∞√ßecekler',
        'Clothes': 'Giyecekler',
        'Body': 'V√ºcut B√∂l√ºmleri'
    };
    return categoryMap[category] || category;
    // flip_cards.js dosyasƒ±na bu kodu ekleyin:

// Kartlara tƒ±klama olayƒ±nƒ± ekleme (mevcut kodunuzun sonuna ekleyin)
function initializeCardClickEvents() {
    const flashcards = document.querySelectorAll('.flashcard');
    
    flashcards.forEach(card => {
        card.addEventListener('click', function() {
            const cardData = {
                image: this.querySelector('.card-image img').src,
                english: this.querySelector('.word').textContent,
                turkish: this.querySelector('.translation').textContent,
                category: this.getAttribute('data-category') || 'Genel',
                level: this.getAttribute('data-level') || 'A1'
            };
            
            openCardModal(cardData);
        });
    });
}

// Sayfa y√ºklendiƒüinde ve kartlar olu≈üturulduƒüunda bu fonksiyonu √ßaƒüƒ±rƒ±n
// √ñrnek kullanƒ±m (mevcut kodunuzda kartlarƒ± olu≈üturduƒüunuz yerde):
document.addEventListener('DOMContentLoaded', function() {
    // Mevcut kodunuz...
    
    // Kartlar olu≈üturulduktan sonra:
    setTimeout(initializeCardClickEvents, 100);
});

// Veya pagination deƒüi≈ütiƒüinde:
function updatePagination() {
    // Mevcut pagination kodunuz...
    
    // Kart event'lerini yeniden ba≈ülat
    initializeCardClickEvents();
}
}
// flip_cards.js dosyasƒ±nƒ±n sonuna ekleyin:

// Kart √ßevrildiƒüinde veya seslendirme yapƒ±ldƒ±ƒüƒ±nda
function trackFlashcardActivity(cardData, action) {
    let points = 0;
    
    switch(action) {
        case 'flip':
            points = 0.3;
            break;
        case 'speak_english':
            points = 0.5;
            break;
        case 'speak_turkish':
            points = 0.5;
            break;
        case 'learned':
            points = 1;
            break;
    }
    
    updateUserProgress(points);
    console.log(`${action} eylemi: ${points} puan`);
}

// Mevcut modal kodunuza entegre edin:
// Modal a√ßƒ±ldƒ±ƒüƒ±nda
function openCardModal(cardData) {
    // Mevcut modal kodunuz...
    
    // Aktivite takibi
    trackFlashcardActivity(cardData, 'flip');
}

// Seslendirme butonlarƒ±na event ekleyin:
document.addEventListener('DOMContentLoaded', function() {
    // English ses butonu
    document.querySelector('.voice-btn[onclick*="speakModalWord(\'en\')"]')?.addEventListener('click', function() {
        const word = document.getElementById('modalCardWord')?.textContent;
        if (word) {
            trackFlashcardActivity({english: word}, 'speak_english');
        }
    });
    
    // Turkish ses butonu
    document.querySelector('.voice-btn[onclick*="speakModalWord(\'tr\')"]')?.addEventListener('click', function() {
        const word = document.getElementById('modalCardTranslation')?.textContent;
        if (word) {
            trackFlashcardActivity({turkish: word}, 'speak_turkish');
        }
    });
});